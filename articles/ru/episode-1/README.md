![Image of this Article](https://raw.githubusercontent.com/totaki/graphql-learn/develop/articles/main.png)

Список эпизодов:
* Эпизод 1
* [Эпизод 2](https://github.com/totaki/graphql-learn/tree/develop/articles/ru/episode-2)

# GraphQL и Python. Эпизод 1

В далекие далекие времена, когда сайты были многостраничными, а web-разработчики обязательно должны были знать PHP, css, html,
умные люди подумали и решили:
> *А зачем нам каждый раз перезагружать страницу, давайте просто будем отправлять запросы и полученные ответы вставлять прямо в разметку*.

И тут на свет появились первые SPA (Single Page Application), а вместе с ними ajax и REST API
. И в общем все хорошо, вырабатали стандарты, создали инструменты для разработки и документирования, такие как [Swagger](https://swagger.io/), и тут
в 2015 году Facebook представила на всеобщее обозрение, свой внтуренний инструмент **GraphQL** (разрабатываемый с 2012 года, [wiki](https://en.wikipedia.org/wiki/GraphQL)) для
работы с API. 

Когда я первый услышал о нем, полез сразу искать есть ли реализация на **python**, и наткнулся на библиотеку
 [Graphene](http://graphene-python.org/). К моему сожалению документация представляля из себя с десяток небольшмх разделов,
 и надо было больше читать саму [документацию GraphQL](http://graphql.org/learn/), а примеры со "Звёздными войнами"
 показались не совсем понятными. Попытка найти развернутые примеры на **python** закончилась провалом и 
 так родилась мысль разобраться в этом получше, а заодно написать небольшую статью, если быть
 точнее серию статей.

## Какие проблемы он решает 
Чтобы понять нужен ли вам GraphQL и стоит ли тратить время на его изчуение, я выделил проблемы, которые, на мой взгляд, он способен
решить

* **URL HELL** 
```
...
/api/1/user/id
/api/2/user/id
/api/1/blogs/id
/api/1/blogs/id
...
```
При добавление новых сущностей REST API начинают разрастаться, вам надо отслеживать версии вашего REST API, на клиенте иметь
множество походих методов для полчения данных, отличающихся только URL и параметрами. 

Вместо это вы получаете раз и навсегда, все точка.
 ```
/graphql
```

* **RESPONSE HELL**

У вас серверное приложение, и для него есть несколько клиентов, например web и mobile, так же когда пользотватель использует 
клиент он может быть как авторизован, так и нет. В классическом REST API это решается либо горождением методов для каждого
клиента, можно конечно передавать ```select```, но в случае авторизации, вам надо проверять может пользователь получать
данные или нет.
```
func to_dict:
    ...
func to_public_dict:
    ...
func to_mobile_dict:
    ...
```
```
/api/user/1?select=id&select=name
```

Вместо это вы просто указываете клиенту какие данные ему запросить, а доступность полей может разрешить через middleware, 
а чтобы не городить ```select``` в каждом запросе, есть ```fragment``` 
```
query {
    user {
        ...userFields
    }
}

fragment userFields on User {
  id
  name
}
```


* **METHODS HELL**

Какой выбрать метод **GET**, **POST**, **PUT**, **DELETE**? Забудьте чтобы получить данные вам надо
```query```, а чтобы изменить ```mutataion```, все точка.


* **REQUESTS HELL**

Тут надо представить "сверического коня в ваккуме". Предположим у нас есть блог, в который пишут пользователи, если мы заходим на станицу пользователя и хотим увидеть его 
профиль, записи в блог и последние комментарии в блоге, по классическому REST API, надо:
```
GET /api/user 
GET /api/posts?user_id=id
GET /api/comments?user_id=id&limit=10
```
Понятно, что можно каким образом запихать это в один запрос и тут вы удивитесь, это и есть **GraphQL** 

```
query {
    user(id: 1) {
        id,
        name,
        posts {
            title,
            link
        }
        comments(last: 10) {
            message
        }
    }
}

```

## Какие проблемы он создает
* **BEST PRACTICE HELL**

У **GraphQL** хорошо описаны клиентские запросы, но как это готовить правильно на сервере я так и не смог найти, попапались
только мнения что их просто нет.

* **LEARN HELL**

Если в REST API у нас есть path, query и body, то в **GraphQL** больше сущностей и они тестно связанны между собой 

* **QUERY HELL**

Вы можете нагородить один МЕГАзапрос, который у вас получает все, но тут проблема не самого **GraphQL**, а скорее проектирования


## А кроме Facebook его вообще кто-то использует?
Конечно когда мы берем какой-то инструмент, хотим понять стоит им пользоваться, в первую очередь смотрим использует его
кто-то или нет, я приведу список пожалуй самых крупных, полный вы можете найти на [старнице](http://graphql.org/users/)
* [github](http://graphql.org/users/)
* [pinterest](https://pinterest.com/)
* [coursera](https://www.coursera.org/)
* [shopify](https://shopify.com/)


С вводной часть мы закончили в [следующем эпизоде](https://github.com/totaki/graphql-learn/tree/develop/articles/ru/episode-2) мы приступим к написаю кода, а также посмотрим какие инструменты помогают
в разработке.

